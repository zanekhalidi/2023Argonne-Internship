# **Introduction**

Here at Argonne, we collect x-rays generated by a synchrotron ring using area detectors for various research purposes. However, some high-energy particles from the universe (known as cosmic rays) can penetrate the atmosphere, and even penetrate our lead walls which are used for keeping outside sources from getting in and scrambling up our x-ray data. They usually leave bright tails on the detector which ruins our data. We want to develop software/algorithms to eliminate the signals of cosmic rays. 








# **Background on cosmic rays**


Cosmic rays are high energy particles that originate from the sun, from outside the solar system in our own galaxy and from distant galaxies. Upon reaching earths atmosphere most rays produce second particles and the bulk dont enter the surface. A significant amount of cosmic rays originate from supernova explosions of stars. During the years from 1930 to 1945, a wide variety of investigations confirmed that the primary cosmic rays are mostly protons, and the secondary radiation produced in the atmosphere is primarily electrons, photons and muons. In 1948, observations with nuclear emulsions carried by balloons to near the top of the atmosphere showed that approximately 10% of the primaries are helium nuclei (alpha particles) and 1% are nuclei of heavier elements such as carbon, iron, and lead. There are 3 types of cosmic rays Primary cosmic rays, secondary cosmic rays and cosmic-ray flux. Primary cosmic rays mostly originate from outside the Solar System and sometimes even outside the Milky Way. Primary cosmic rays are composed mainly of protons and alpha particles (99%), with a small amount of heavier nuclei (â‰ˆ1%) and an extremely minute proportion of positrons and antiprotons.

![Hard-component-muon-868x1024](https://github.com/zanekhalidi/2023Argonne-Internship/assets/136121434/7641c26f-4a39-48cb-902c-cfb78b70e878) 

Caption:
Left image: cosmic ray muon passing through a cloud chamber undergoes scattering by a small angle in the middle metal plate and leaves the chamber. Right image: cosmic ray muon losing considerable energy after passing through the plate as indicated by the increased curvature of the track in a magnetic field. Source: Wikipedia

![cosmic_ray_path](https://github.com/zanekhalidi/2023Argonne-Internship/assets/136121434/ad790e76-a478-4bdd-9323-c54a1e9561a0)

Caption:
Because cosmic rays carry electric charge, their direction changes as they travel through magnetic fields. By the time the particles reach us, their paths are completely scrambled, as shown by the blue path. We can't trace them back to their sources. Light travels to us straight from their sources, as shown by the purple path. (Credit: NASA's Goddard Space Flight Center)

There are also secondary rays. When cosmic rays enter the Earth's atmosphere, they collide with atoms and molecules, mainly oxygen and nitrogen. The interaction produces a cascade of lighter particles, a so-called air shower secondary radiation that rains down, including x-rays, protons, alpha particles, pions, muons, electrons, neutrinos, and neutrons. All of the secondary particles produced by the collision continue onward on paths within about one degree of the primary particle's original path. 



# **Our Algorithm**

**A small Summary of what the code does:**

This code was written in Python and created for the purpose of taking the x-ray images that have been corrupted by cosmic rays and filtering out those cosmic ray bits from the image. We implemented certain *packages* within python such as Numpy, matplotlab, skimage, glob, time, pandas and os. Within the code you will also find *functions*. These different functions serve different purposes and some of them are made specifically to filter out these cosmic rays from our x-ray images. 





**A Summary of each function:**

*combine_imgs*
1. Combines three input images (img, img2, bkg) side by side to create a single composite image.
2. The intensity values of each input image are normalized and adjusted to fit within the range of 0 to 255 before combining.
3. The function returns the composite image.

https://github.com/zanekhalidi/2023Argonne-Internship/blob/8609489428c6cfd0d1398d2bf5564feba2d3a997/ANL_Image_Code.py?plain=1#L17-L32

*remove_connected_original*
1. Removes connected regions (connected components) from the input binary image (img) based on their size.
2. It labels the connected regions in the binary image and calculates the size of each region.
3. Connected regions with a size below the specified *count_cutoff*  are considered noise and are removed by setting their pixels to zero.
4. The function returns the cleaned binary image (img2) and the background image (bkg) containing the removed regions.

https://github.com/zanekhalidi/2023Argonne-Internship/blob/8609489428c6cfd0d1398d2bf5564feba2d3a997/ANL_Image_Code.py?plain=1#L47-L84

*remove_connected_dilation*
1. Removes connected regions from the input binary image (img) using a different approach.
2. It labels connected regions in the binary image and counts the pixels in each region.
3. Connected regions with a size below the specified *count_cutoff* are considered noise and are removed by setting their pixels to zero.
4. The function returns the cleaned binary image (img2) and the background image (bkg) containing the removed regions.

https://github.com/zanekhalidi/2023Argonne-Internship/blob/8609489428c6cfd0d1398d2bf5564feba2d3a997/ANL_Image_Code.py?plain=1#L87-L114

*remove_connected*
1. Removes connected regions from the input binary image (img) based on region properties like area and solidity.
2. It labels connected regions in the binary image and computes region properties such as area and solidity.
3. Regions with an area less than 5 or solidity greater than or equal to 0.4 are considered noise and are removed by setting their pixels to zero.
4. The function returns the cleaned binary image (img2) and the background image (bkg) containing the removed regions.

https://github.com/zanekhalidi/2023Argonne-Internship/blob/8609489428c6cfd0d1398d2bf5564feba2d3a997/ANL_Image_Code.py?plain=1#L117-L143

![thumbnail_remove_connected drawio](https://github.com/zanekhalidi/2023Argonne-Internship/assets/136121434/e2ca9d1b-9810-468f-9a40-4888af8225ee)

*show_result*
1. Displays three images side by side in a figure: the original image (img), the cleaned image (img2), and the background image (bkg).

https://github.com/zanekhalidi/2023Argonne-Internship/blob/8609489428c6cfd0d1398d2bf5564feba2d3a997/ANL_Image_Code.py?plain=1#L146-L166

*show_images*
1. Displays a single image in a plot with a color bar to visualize its intensity values.

https://github.com/zanekhalidi/2023Argonne-Internship/blob/8609489428c6cfd0d1398d2bf5564feba2d3a997/ANL_Image_Code.py?plain=1#L34-L37

*__main__*
1. The main part of the code reads multiple image files, applies the *remove_connected_original* function to each image, combines the original image, cleaned image, and background image into a composite image, and saves the composite image as a JPEG file. It measures the time taken to process each image file and prints the time taken for each operation.

https://github.com/zanekhalidi/2023Argonne-Internship/blob/8609489428c6cfd0d1398d2bf5564feba2d3a997/ANL_Image_Code.py?plain=1#L169-L194

**An example of the output:**
![29Feb2023_scan113_point049](https://github.com/zanekhalidi/2023Argonne-Internship/assets/136121434/cebecc69-e878-4319-96b7-617b75e149af)

As you can see here the figure on the bottom of the image to the left that looks similar to a broom is present within the image. This is infact a cosmic ray. We then see that within the next two images it is filtered out. 



**Flowchart:**

![image](https://github.com/zanekhalidi/2023Argonne-Internship/assets/136121434/970a9342-c74d-4b8f-bf93-3d153e91b1d5)


